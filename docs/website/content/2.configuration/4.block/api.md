# Api

The `api` block bundles endpoints under a certain `base_path`.

&#9888; If an error occurred for api endpoints the response gets processed
as JSON error with an error body payload. This can be customized via `error_file`.

| Block name | Context                       | Label    | Nested block(s)                                                                                                 |
|:-----------|:------------------------------|:---------|:----------------------------------------------------------------------------------------------------------------|
| `api`      | [Server Block](#server-block) | Optional | [Endpoint Block(s)](#endpoint-block), [CORS Block](#cors-block), [Error Handler Block(s)](#error-handler-block) |

| Attribute(s)               | Type                                               | Default                                                                   | Description                                                                                                                                                                   | Characteristic(s)                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Example                                                                                                                                                                    |
|:---------------------------|:---------------------------------------------------|:--------------------------------------------------------------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `base_path`                | string                                             | -                                                                         | Configures the path prefix for all requests.                                                                                                                                  || `base_path = "/v1"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `error_file`               | string                                             | -                                                                         | Location of the error file template.                                                                                                                                          | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `error_file = "./my_error_body.json"`                                                                                                                                      |
| `access_control`           | tuple (string)                                     | -                                                                         | Sets predefined [Access Control](#access-control) for `api` block context.                                                                                                    | &#9888; Inherited by nested blocks.                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `access_control = ["foo"]`                                                                                                                                                 |
| `disable_access_control`   | tuple (string)                                     | -                                                                         | Disables access controls by name.                                                                                                                                             | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `disable_access_control = ["foo"]`                                                                                                                                         |
| `allowed_methods`          | tuple (string)                                     | `["*"]` == `["GET", "HEAD", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]` | Sets allowed methods as _default_ for all contained endpoints. Requests with a method that is not allowed result in an error response with a `405 Method Not Allowed` status. | The default value `*` can be combined with additional methods. Methods are matched case-insensitively. `Access-Control-Allow-Methods` is only sent in response to a [CORS](#cors-block) preflight request, if the method requested by `Access-Control-Request-Method` is an allowed method.                                                                                                                                                                                           | `allowed_methods = ["GET", "POST"]` or `allowed_methods = ["*", "BREW"]`                                                                                                   |
| `beta_required_permission` | expression evaluating to string or object (string) | -                                                                         | Permission required to use this API (see [error type](ERRORS.md#error-types) `beta_insufficient_permissions`).                                                                | If the value is a string, the same permission applies to all request methods. If there are different permissions for different request methods, use an object with the request methods as keys and string values. Methods not specified in this object are not permitted. `"*"` is the key for "all other standard methods". Methods other than `GET`, `HEAD`, `POST`, `PUT`, `PATCH`, `DELETE`, `OPTIONS` must be specified explicitly. A value `""` means "no permission required". | `beta_required_permission = "read"` or `beta_required_permission = { post = "write", "*" = "" }` or `beta_required_permission = default(request.path_params.p, "not_set")` |
| `custom_log_fields`        | object                                             | -                                                                         | Defines log fields for [Custom Logging](LOGS.md#custom-logging).                                                                                                              | &#9888; Inherited by nested blocks.                                                                                                                                                                                                                                                                                                                                                                                                                                                   | -                                                                                                                                                                          |
