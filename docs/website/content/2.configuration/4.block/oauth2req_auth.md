# OAuth2

The `oauth2` block in the [Backend Block](backend) context configures an OAuth2 flow to request a bearer token for the backend request.

**Note:** The token received from the authorization server's token endpoint is stored **per backend**. So even with flows where a user's account characteristics like username/password or email address are involved, there is no way to "switch" from one user to another depending on the client request.

| Block name | Context                  | Label    | Nested block(s)          |
|:-----------|:-------------------------|:---------|:-------------------------|
| `oauth2`   | [Backend Block](backend) | no label | [Backend Block](backend) |

| Attribute(s)                 | Type    | Default                 | Description                                                                                                                     | Characteristic(s)                                                                                                                                                                                 | Example                                 |
|:-----------------------------|:--------|:------------------------|:--------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------|
| `backend`                    | string  | -                       | [Backend Block Reference](backend)                                                                                              | -                                                                                                                                                                                                 | -                                       |
| `grant_type`                 | string  | -                       | -                                                                                                                               | &#9888; required, valid values: `"client_credentials"`, `"password"`, `"urn:ietf:params:oauth:grant-type:jwt-bearer"`                                                                             | `grant_type = "client_credentials"`     |
| `token_endpoint`             | string  | -                       | URL of the token endpoint at the authorization server.                                                                          | &#9888; required                                                                                                                                                                                  | -                                       |
| `client_id`                  | string  | -                       | The client identifier.                                                                                                          | &#9888; required unless the client is authenticated via the JWT assertion with `grant_type = "urn:ietf:params:oauth:grant-type:jwt-bearer"`.                                                      | -                                       |
| `client_secret`              | string  | -                       | The client password.                                                                                                            | &#9888; required unless the client is authenticated via the JWT assertion with `grant_type = "urn:ietf:params:oauth:grant-type:jwt-bearer"`.                                                      | -                                       |
| `retries`                    | integer | `1`                     | The number of retries to get the token and resource, if the resource-request responds with `401 Unauthorized` HTTP status code. | -                                                                                                                                                                                                 | -                                       |
| `token_endpoint_auth_method` | string  | `"client_secret_basic"` | Defines the method to authenticate the client at the token endpoint.                                                            | If set to `"client_secret_post"`, the client credentials are transported in the request body. If set to `"client_secret_basic"`, the client credentials are transported via Basic Authentication. | -                                       |
| `scope`                      | string  | -                       | A space separated list of requested scope values for the access token.                                                          | -                                                                                                                                                                                                 | `scope = "read write"`                  |
| `username`                   | string  | -                       | The (service account's) username (for password flow).                                                                           | &#9888; required if `grant_type` is `"password"`.                                                                                                                                                 | `username = env.SERVICE_ACCOUNT_USER`   |
| `password`                   | string  | -                       | The (service account's) password (for password flow).                                                                           | &#9888; required if `grant_type` is `"password"`.                                                                                                                                                 | `username = env.SERVICE_ACCOUNT_PASSWD` |
| `assertion`                  | string  | -                       | The assertion (JWT for jwt-bearer flow).                                                                                        | &#9888; required if `grant_type` is `"urn:ietf:params:oauth:grant-type:jwt-bearer"`.                                                                                                              | `assertion = jwt_sign("sp", {})`        |

The HTTP header field `Accept: application/json` is automatically added to the token request. This can be modified with [request header modifiers](../modifiers#request-header) in a [backend block](backend).
