# OAuth2 AC (Beta)

The `beta_oauth2` block lets you configure the [`oauth2_authorization_url()` function](../functions) and an access
control for an OAuth2 **Authorization Code Grant Flow** redirect endpoint.
Like all [access control](../access-control) types, the `beta_oauth2` block is defined in the [`definitions` block](definitions) and can be referenced in all configuration blocks by its required _label_.

| Block name    | Context                                 | Label            | Nested block(s)                                                              |
|:--------------|:----------------------------------------|:-----------------|:-----------------------------------------------------------------------------|
| `beta_oauth2` | [Definitions Block](definitions) | &#9888; required | [Backend Block](backend), [Error Handler Block](error_handler) |

| Attribute(s)                 | Type                 | Default                 | Description                                                            | Characteristic(s)                                                                                                                                                                                                                 | Example                                     |
|:-----------------------------|:---------------------|:------------------------|:-----------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------|
| `backend`                    | string               | -                       | [Backend Block Reference](backend)                              | &#9888; Do not disable the peer certificate validation with `disable_certificate_validation = true`!                                                                                                                              | -                                           |
| `authorization_endpoint`     | string               | -                       | The authorization server endpoint URL used for authorization.          | &#9888; required                                                                                                                                                                                                                  | -                                           |
| `token_endpoint`             | string               | -                       | The authorization server endpoint URL used for requesting the token.   | &#9888; required                                                                                                                                                                                                                  | -                                           |
| `token_endpoint_auth_method` | string               | `"client_secret_basic"` | Defines the method to authenticate the client at the token endpoint.   | If set to `client_secret_post"`, the client credentials are transported in the request body. If set to `"client_secret_basic"`, the client credentials are transported via Basic Authentication.                                  | -                                           |
| `redirect_uri`               | string               | -                       | The Couper endpoint for receiving the authorization code.              | &#9888; required. Relative URL references are resolved against the origin of the current request URL. The origin can be changed with the [`accept_forwarded_url`](settings) attribute if Couper is running behind a proxy. | -                                           |
| `grant_type`                 | string               | -                       | The grant type.                                                        | &#9888; required, to be set to: `"authorization_code"`                                                                                                                                                                            | `grant_type = "authorization_code"`         |
| `client_id`                  | string               | -                       | The client identifier.                                                 | &#9888; required                                                                                                                                                                                                                  | -                                           |
| `client_secret`              | string               | -                       | The client password.                                                   | &#9888; required.                                                                                                                                                                                                                 | -                                           |
| `scope`                      | string               | -                       | A space separated list of requested scope values for the access token. | -                                                                                                                                                                                                                                 | `scope = "read write"`                      |
| `verifier_method`            | string               | -                       | The method to verify the integrity of the authorization code flow      | &#9888; required, available values: `"ccm_s256"` (`code_challenge` parameter with `code_challenge_method` `S256`), `"state"` (`state` parameter)                                                                                  | `verifier_method = "ccm_s256"`              |
| `verifier_value`             | string or expression | -                       | The value of the (unhashed) verifier.                                  | &#9888; required; e.g. using cookie value created with [`oauth2_verifier()` function](../functions)                                                                                                                                 | `verifier_value = request.cookies.verifier` |
| `custom_log_fields`          | object               | -                       | Defines log fields for [Custom Logging](/observation/logging#custom-logging).       | &#9888; Inherited by nested blocks.                                                                                                                                                                                               | -                                           |

If the authorization server supports the `code_challenge_method` `S256` (a.k.a. PKCE, see RFC 7636), we recommend `verifier_method = "ccm_s256"`.

The HTTP header field `Accept: application/json` is automatically added to the token request. This can be modified with [request header modifiers](../modifiers#request-header) in a [backend block](backend).
